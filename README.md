# ESTL_Coding_Assessment
### Jasmine Tan Jia Min

[Assessment Instructions](https://go.gov.sg/estl-tech-assessment)

## Running in Local Environment
1. Clone this repository in preferred local device
2. Install Go [here](https://go.dev/doc/install)
3. Install Gin package, the HTTP Web Framework used in this project with
`go get -u github.com/gin-gonic/gin`
4. In the project folder, run `go mod tidy && go mod vendor`
5. Run project with `go run .`
6. Check if service is up using the [healthcheck endpoint](http://localhost:8080)

## Project Layout
### controllers
The HTTP handlers for processing the requests.

### daos
The Data Access layer to interact with the data storage.

### domains
Contains the business domain objects.

### models
Models are generated by SQLBoiler. You shouldn't modify any file in this folder.

## Assumptions
### Database Setup
To reduce the amount of setup necessary, I have decided to host the database on an AWS RDS so there is no need to spin up another DB instance on one's local machine. <br><br>
However, in the event that the connection to the cloud database is not stable, one can choose to connect to their own database instance and change the configuration in the `sqlboiler.toml` file.
The sql file containing the database schema can be found in the **/resources** folder.

To regenerate the models, [sqlboiler](https://github.com/volatiletech/sqlboiler) is necessary. <br>
To get started with sqlboiler:
1. Install sqlboiler with the commands:
```
# Go 1.16 and above:
go install github.com/volatiletech/sqlboiler/v4@latest
go install github.com/volatiletech/sqlboiler/v4/drivers/sqlboiler-psql@latest

# Go 1.15 and below:
# Install sqlboiler v4 and the postgresql driver (mysql, mssql, sqlite3 also available)
# NOTE: DO NOT run this inside another Go module (like your project) as it will
# pollute your go.mod with a bunch of stuff you don't want and your binary
# will not get installed.
GO111MODULE=on go get -u -t github.com/volatiletech/sqlboiler/v4
GO111MODULE=on go get github.com/volatiletech/sqlboiler/v4/drivers/sqlboiler-psql
```
2. Run command: `sqlboiler -c sqlboiler.toml --wipe mysql`

### User Story 1
##### POST http://localhost:8080/users/upload
##### Body: form-data 

##### cURL: 
`curl --location --request POST 'http://localhost:8080/users/upload' --form 'file=@"./resources/sample.csv"'
`
<br>

##### Assumptions
1. An empty file should throw an error message 
2. An error in an earlier file should not stop subsequent files that were uploaded from being processed. 
3. Even though files can be uploaded concurrently, only one file will be processed at one time.

### User Story 2
##### GET http://localhost:8080/users?minSalary=1000&maxSalary=4000&offset=0&limit=30&sort=%2Bname
##### Body: nil

##### cURL
`curl --location --request GET 'http://localhost:8080/users?minSalary=1000&maxSalary=4000&offset=0&limit=30&sort=%2Bname'`
<br>

##### Assumptions
1. "+" in sort is represent by "%2B" in the URL instead of the symbol while "-" is represented by the symbol itself <br>
i.e. To sort name by ascending order: `GET http://localhost:8080/users?sort=%2Bname` <br>
To sort by descending order: `GET http://localhost:8080/users?sort=-name`

### User Story 3
##### POST http://localhost:8080/users/
##### Body: application/json
```
{
    "id": "e0011",
    "name": "George Weasley",
    "login": "notfred",
    "salary": 8774.29
}
```
##### cURL: 
`curl --location --request POST 'http://localhost:8080/users/' \
--header 'Content-Type: application/json' \
--data-raw '{
"id": "e0011",
"name": "George Weasley",
"login": "notfred",
"salary": 8774.29
}'`

##### Assumptions
1. Assuming id is not auto-generated, the request body for the POST request should be as shown above.

<br>


##### PUT http://localhost:8080/users/{id}
##### Body: application/json
```
{
    "name": "George Weasley",
    "login": "notfreddie",
    "salary": 8774.29
}
```
##### cURL: 
`curl --location --request PUT 'http://localhost:8080/users/e0011' \
--header 'Content-Type: application/json' \
--data-raw '{
"name": "George Weasley",
"login": "notfreddie",
"salary": 8774.29
}'`

<br>

##### GET http://localhost:8080/users/{id}
##### Body: nil
##### cURL:
`curl --location --request GET 'http://localhost:8080/users/e0011' \
--data-raw ''`

##### Assumptions:
1. user id is not to be returned when this endpoint is called

<br>

##### DELETE http://localhost:8080/users/{id}
##### Body: nil
##### cURL:
`curl --location --request DELETE 'http://localhost:8080/users/e0011' \
--data-raw ''`

##### Assumptions:
1. Requirement calls for a hard delete, not a soft delete.

